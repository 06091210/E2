<!--<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>E2</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script>
    window.MathJax = {
      tex: {
        displayMath: [["\\[", "\\]"], ["$$", "$$"]]
      },
      chtml: {
        displayAlign: 'left'
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
  <textarea id="latexInput" style="width: 100%; height: 10em; font-family: monospace;"></textarea>
  <div id="output" style="white-space: pre-wrap; overflow-x: auto;">
  </div>
  <script>
    const input = document.getElementById("latexInput");
    const output = document.getElementById("output");
    input.addEventListener("input", () => {
      output.innerHTML = input.value;
      MathJax.typesetPromise([output]);
    });
    output.innerHTML = input.value;
    MathJax.typesetPromise([output]);
  </script>
</body>
</html>-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>E2</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script>
    window.MathJax = {
      tex: {
        displayMath: [["\\[", "\\]"], ["$$", "$$"]],
      },
      chtml: {
        displayAlign: 'left'
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <!-- テキストエリア -->
  <textarea id="latexInput" style="width: 100%; height: 10em; font-family: monospace;"></textarea>

  <!-- 挿入ボタン -->
  <button id="insertAbBtn">ab を挿入</button>

  <!-- 出力 -->
  <div id="output" style="white-space: pre-wrap; overflow-x: auto;"></div>

  <script>
    const input = document.getElementById("latexInput");
    const output = document.getElementById("output");
    const insertAbBtn = document.getElementById("insertAbBtn");

    // MathJax 表示更新
    function updateMath() {
      output.innerHTML = input.value;
      MathJax.typesetPromise([output]);
    }

    input.addEventListener("input", updateMath);
    updateMath();

    // カーソル位置に文字列を挿入する関数
    function insertAtCursor(textarea, text) {
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const before = textarea.value.substring(0, start);
      const after = textarea.value.substring(end);
      textarea.value = before + text + after;
      textarea.selectionStart = textarea.selectionEnd = start + text.length;
      textarea.focus();
      updateMath();
    }

    // ボタンクリックで "ab" を挿入
    insertAbBtn.addEventListener("click", () => {
      insertAtCursor(input, "ab");
    });
  </script>
</body>
</html>

